<?xml version="1.0" encoding="utf-8" ?>
<odoo>
  <report id="report_session" model="account.payment" string="Pago Beeren" 
  name="pago_formulario.report_pago_beeren" file="pago_formulario.report_session" report_type="qweb-pdf" />
  
  <template id="report_pago_beeren">
    <t t-call="web.html_container">
      <t t-set="data_report_margin_top" t-value="12"/>
      <t t-set="data_report_header_spacing" t-value="0"/>
      <!--<t t-set="data_report_dpi" t-value="110"/>-->
        <t t-foreach="docs" t-as="o">
            <t t-call="web.basic_layout">

                <div class="container-fluid">
                  <div class="row" style="font-size: 12px;">
                    <div class="col-12 text-left">
                      <img t-att-src="image_data_uri(o.company_id.logo)" width="118px" height="60px"/>
                    </div>
                  </div>
                </div>

              <t t-call="web.external_layout">
                  <t t-set="o" t-value="o.with_context(lang=lang)"/>
                  <div class="page">
                      <h3><strong>Pago: <span t-field="o.name"/></strong></h3>
                      <div class="mb-4 mt-3">
                          <div class="row">
                              <div class="col-6" t-if="o.date">
                                  Fecha de Pago: <span t-field="o.date"/>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-6" t-if="o.partner_type">
                                  <t t-if="o.partner_type == 'customer'">
                                      Cliente:
                                  </t>
                                  <t t-if="o.partner_type == 'supplier'">
                                      Empresa:
                                  </t><span t-field="o.partner_id"/>
                              </div>
                              <div class="col-6" t-if="o.payment_method_id">
                                  Metodo de Pago: <span t-field="o.payment_method_id.name"/>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-6" t-if="o.amount">
                                  Monto de Pago: <span t-field="o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                              </div>
                              <div class="col-6" t-if="o.ref">
                                  Memo: <span t-field="o.ref"/>
                              </div>
                          </div>
                      </div>

                      <t t-set="partials" t-value="o.move_id._get_reconciled_invoices_partials()"/>
                      <t t-set="invoices" t-value="{partial[2].move_id for partial in partials}"/>
                      <!-- Check if invoices include different currencies -->
                      <t t-foreach="invoices" t-as="inv">
                          <t t-if="any(inv.currency_id != par[2].currency_id for par in inv._get_reconciled_invoices_partials())" t-set="otherCurrency" t-value="True"/>
                      </t>

                      <table class="table table-sm">
                          <thead>
                              <tr>
                                  <th><span>Invoice Date</span></th>
                                  <th><span>Invoice Number</span></th>
                                  <th><span>Reference</span></th>
                                  <!-- Add a column if there are different currencies -->
                                  <th t-if="otherCurrency" class="text-right"><span>Amount In Currency</span></th>
                                  <th class="text-right"><span>Amount</span></th>
                              </tr>
                          </thead>
                          <tbody>
                              <t t-foreach="invoices" t-as="inv">
                                  <!-- MOVE -->
                                  <t t-if="inv.move_type != 'entry'">
                                      <tr>
                                          <td><span t-field="inv.invoice_date"/></td>
                                          <td><span t-field="inv.name"/></td>
                                          <td><span t-field="inv.ref"/></td>
                                          <td t-if="otherCurrency"/>
                                          <td class="text-right"><span t-field="inv.amount_total"/></td>
                                      </tr>
                                      <!-- PAYMENTS/REVERSALS -->
                                      <tr t-foreach="inv._get_reconciled_invoices_partials()" t-as="par">
                                          <t t-set="payment" t-value="par[2].move_id"/>
                                          <td><span t-field="payment.date"/></td>
                                          <td><span t-field="payment.name"/></td>
                                          <td><span t-field="payment.ref"/></td>
                                          <t t-set="amountPayment" t-value="-payment.amount_total"/>
                                          <t t-set="amountInvoice" t-value="-par[1]"/>
                                          <t t-set="currencyPayment" t-value="payment.currency_id"/>
                                          <t t-set="currencyInvoice" t-value="inv.currency_id"/>
                                          <!-- Fill the column "Amount In Currency" only if necessary -->
                                          <td t-if="otherCurrency" class="text-right"><span t-if="currencyPayment != currencyInvoice" t-esc="amountPayment" t-options="{'widget': 'monetary', 'display_currency': currencyPayment}"/></td>
                                          <td class="text-right"><span t-esc="amountInvoice" t-options="{'widget': 'monetary', 'display_currency': currencyInvoice}"/></td>
                                      </tr>
                                      <!-- BALANCE -->
                                      <tr>
                                          <td/>
                                          <td><strong>Due Amount for <span t-field="inv.name"/></strong></td>
                                          <td/>
                                          <td t-if="otherCurrency"/>
                                          <td class="text-right"><strong><span t-field="inv.amount_residual"/></strong></td>
                                      </tr>
                                  </t>
                              </t>
                          </tbody>
                      </table>
                  </div>
              </t>
            </t>
        </t>
    </t>
  </template>
</odoo>






